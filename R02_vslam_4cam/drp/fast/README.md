# SLAM組みこみ用DRP実装API仕様書（FAST）

特徴点を抽出します。

## パラメータ

| メンバ名 | 型 | 説明 |
| ---- | ---- | ---- |
| addr | uint32_t | 入力画像のアドレス |
| addw_keypoints | uint32_t | 出力する特徴点配列のアドレス |
| addw_num | uint32_t | 出力する特徴点の個数のアドレス |
| width | uint16_t | 画像の幅(ピクセル) |
| height | uint16_t | 画像の高さ(ピクセル) |

## 入出力詳細

### 入力画像

| 項目 | 説明 |
| ---- | ---- |
| アドレス | addrで指定 |
| 幅(ピクセル) | widthで指定(16～1920) |
| 高さ(ピクセル) | heightで指定(16～960) |
| フォーマット | 8bitグレイスケール(1ピクセルあたり1バイト) |
| データサイズ | (width) x (height) x 1バイト |

### 出力する特徴点配列

| 項目 | 説明 |
| ---- | ---- |
| アドレス | addw_keypointsで指定 |
| データサイズ | 最大で(width) x (height) x 8バイト |
| フォーマット | アドレス先頭から、抽出した特徴点のX座標値(2バイト)、抽出した特徴点のY座標値(2バイト)、抽出した特徴点のスコア(1バイト)、0パディング(3バイト) |

アドレスの先頭から、特徴点のX座標、Y座標、スコアが8バイト単位で出力されます。

#### 特徴点

| メンバ名 | 型 | 説明 |
| ---- | ---- | ---- |
| x | uint16_t | 水平位置 |
| y | uint16_t | 垂直位置 |
| response | int16_t | スコア |

### 出力する特徴点の個数

| 項目 | 説明 |
| ---- | ---- |
| アドレス | addw_numで指定 |
| データサイズ | 2バイト |

## 解説

本機能は、`addr`で指定したアドレスの画像にFAST特徴点抽出を行い、`addw_keypoints`と`addw_num`で指定したアドレスに出力します。

FASTは、画像からコーナーとなる特徴点を抽出するアルゴリズムです。

本機能は、入力画像をセル画像に分割し、各セル画像にOpenCVの`cv::FAST`関数の引数に以下のパラメータを指定した場合と同等の結果が得られます。

- `threshold`に`20`
- `nonmax_suppression`に`true`

ただし、`threshold = 20`で特徴点が1つも得られなかったセル画像からはOpenCVの`cv::FAST`関数の引数に以下のパラメータを指定した場合と同等の結果が得られます。

- `threshold`に`7`
- `nonmax_suppression`に`true`

参考URL : <https://docs.opencv.org/3.2.0/d5/d51/group__features2d__main.html#ga816d870cbdca71c6790c71bdf17df099>

## 注意

BDLにはC言語の数学関数の`ceil`に相当する関数が用意されていません。  
そのため、動作確認した`640x480`の画像で`ceil`相当の結果を得られるように実装を行っています。  
ただし、動作確認した`640x480`の画像以外では意図した結果を得られない可能性があるという既知の問題があります。
